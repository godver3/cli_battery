<div class="settings-section">
    <div class="settings-section-header">
        <h4>Trakt Settings</h4>
    </div>
    <div class="settings-section-content active">
        <div class="settings-form-group">
            <label for="trakt_client_id" class="settings-title">Client ID:</label>
            <input type="text" id="trakt_client_id" name="trakt_client_id" class="settings-input" value="{{ settings.Trakt.client_id }}">
        </div>
        <div class="settings-form-group">
            <label for="trakt_client_secret" class="settings-title">Client Secret:</label>
            <input type="password" id="trakt_client_secret" name="trakt_client_secret" class="settings-input" value="{{ settings.Trakt.client_secret }}">
        </div>
        <div class="settings-form-group">
            <label for="trakt_update_frequency" class="settings-title">Update Frequency (minutes):</label>
            <input type="number" id="trakt_update_frequency" name="trakt_update_frequency" class="settings-input" value="{{ settings.Trakt.update_frequency }}">
            <p class="settings-description">How often to update Trakt metadata.</p>
        </div>
        <div class="settings-form-group">
            <button type="button" id="authorizeTraktButton" class="btn btn-primary">Authorize Trakt</button>
            <p id="traktAuthStatus" class="settings-description"></p>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    function checkTraktAuth() {
        fetch('/check_trakt_auth')
            .then(response => response.json())
            .then(data => {
                const authStatus = document.getElementById('traktAuthStatus');
                const authorizeButton = document.getElementById('authorizeTraktButton');
                if (data.is_authenticated) {
                    authStatus.textContent = 'Trakt is authorized.';
                    authStatus.style.color = 'green';
                    authorizeButton.textContent = 'Reauthorize Trakt';
                } else {
                    authStatus.textContent = 'Trakt is not authorized.';
                    authStatus.style.color = 'red';
                    authorizeButton.textContent = 'Authorize Trakt';
                }
            });
    }

    checkTraktAuth();

    document.getElementById('authorizeTraktButton').addEventListener('click', function() {
        fetch('/authorize_trakt')
            .then(response => response.json())
            .then(data => {
                if (data.auth_url) {
                    window.open(data.auth_url, '_blank');
                    document.getElementById('traktAuthStatus').textContent = 'Authorization window opened. Please complete the process there.';
                } else {
                    document.getElementById('traktAuthStatus').textContent = 'Failed to get authorization URL.';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('traktAuthStatus').textContent = 'Error initiating Trakt authorization.';
            });
    });
});
</script>